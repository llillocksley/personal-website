"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2588],{4226:(e,t,r)=>{r.d(t,{h1:()=>o,uA:()=>n});var a=r(63187);class n{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}let i="[DEFAULT]";class s{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){let t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){let e=new a.cY;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{let r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;let r=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),a=null!=(t=null==e?void 0:e.optional)&&t;if(this.isInitialized(r)||this.shouldAutoInitialize())try{return this.getOrInitializeService({instanceIdentifier:r})}catch(e){if(a)return null;throw e}if(a)return null;throw Error(`Service ${this.name} is not available`)}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if("EAGER"===e.instantiationMode)try{this.getOrInitializeService({instanceIdentifier:i})}catch(e){}for(let[e,t]of this.instancesDeferred.entries()){let r=this.normalizeInstanceIdentifier(e);try{let e=this.getOrInitializeService({instanceIdentifier:r});t.resolve(e)}catch(e){}}}}clearInstance(e=i){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){let e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(e=i){return this.instances.has(e)}getOptions(e=i){return this.instancesOptions.get(e)||{}}initialize(e={}){let{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error(`${this.name}(${r}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);let a=this.getOrInitializeService({instanceIdentifier:r,options:t});for(let[e,t]of this.instancesDeferred.entries())r===this.normalizeInstanceIdentifier(e)&&t.resolve(a);return a}onInit(e,t){var r;let a=this.normalizeInstanceIdentifier(t),n=null!=(r=this.onInitCallbacks.get(a))?r:new Set;n.add(e),this.onInitCallbacks.set(a,n);let i=this.instances.get(a);return i&&e(i,a),()=>{n.delete(e)}}invokeOnInitCallbacks(e,t){let r=this.onInitCallbacks.get(t);if(r)for(let a of r)try{a(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){var r;let a=this.instances.get(e);if(!a&&this.component&&(a=this.component.instanceFactory(this.container,{instanceIdentifier:(r=e)===i?void 0:r,options:t}),this.instances.set(e,a),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(a,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,a)}catch(e){}return a||null}normalizeInstanceIdentifier(e=i){return this.component?this.component.multipleInstances?e:i:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class o{constructor(e){this.name=e,this.providers=new Map}addComponent(e){let t=this.getProvider(e.name);if(t.isComponentSet())throw Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);let t=new s(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}},12818:(e,t)=>{var r,a;Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidTokenError=t.InvalidTokenReason=t.AuthError=t.AuthErrorCode=void 0,t.isInvalidTokenError=function(e){return e?.isInvalidTokenError??!1},function(e){e.USER_NOT_FOUND="USER_NOT_FOUND",e.USER_DISABLED="USER_DISABLED",e.INVALID_CREDENTIAL="INVALID_CREDENTIAL",e.TOKEN_EXPIRED="TOKEN_EXPIRED",e.TOKEN_REVOKED="TOKEN_REVOKED",e.INVALID_ARGUMENT="INVALID_ARGUMENT",e.INTERNAL_ERROR="INTERNAL_ERROR",e.NO_KID_IN_HEADER="NO_KID_IN_HEADER",e.INVALID_SIGNATURE="INVALID_SIGNATURE",e.NO_MATCHING_KID="NO_MATCHING_KID",e.MISMATCHING_TENANT_ID="MISMATCHING_TENANT_ID"}(r||(t.AuthErrorCode=r={}));let n={[r.USER_NOT_FOUND]:"User not found",[r.INVALID_CREDENTIAL]:"Invalid credentials",[r.TOKEN_EXPIRED]:"Token expired",[r.USER_DISABLED]:"User disabled",[r.TOKEN_REVOKED]:"Token revoked",[r.INVALID_ARGUMENT]:"Invalid argument",[r.INTERNAL_ERROR]:"Internal error",[r.NO_KID_IN_HEADER]:"No kid in jwt header",[r.INVALID_SIGNATURE]:"Invalid token signature.",[r.NO_MATCHING_KID]:"Kid is not matching any certificate",[r.MISMATCHING_TENANT_ID]:"Provided tenant ID does not match firebase tenant ID from the token"};function i(e,t){let r="string"==typeof t?.stack?t.stack:"",a="string"==typeof t?.cause?t.cause:"";e.stack=(e?.stack??"")+r,e.cause=(e?.cause??"")+a}class s extends Error{code;static fromError(e,t,r){let a=new s(t,r);return i(a,e),a}constructor(e,t){super(function(e,t){return t?`${n[e]}: ${t}`:n[e]}(e,t)),this.code=e,Object.setPrototypeOf(this,s.prototype)}toJSON(){return{code:this.code,message:this.message}}}t.AuthError=s,function(e){e.MISSING_CREDENTIALS="MISSING_CREDENTIALS",e.MISSING_REFRESH_TOKEN="MISSING_REFRESH_TOKEN",e.MALFORMED_CREDENTIALS="MALFORMED_CREDENTIALS",e.INVALID_SIGNATURE="INVALID_SIGNATURE",e.INVALID_CREDENTIALS="INVALID_CREDENTIALS",e.INVALID_KID="INVALID_KID"}(a||(t.InvalidTokenReason=a={}));let o={[a.MISSING_CREDENTIALS]:"Missing credentials",[a.MALFORMED_CREDENTIALS]:"Credentials are incorrectly formatted",[a.INVALID_SIGNATURE]:"Credentials have invalid signature",[a.MISSING_REFRESH_TOKEN]:"Refresh token is missing",[a.INVALID_CREDENTIALS]:"Invalid credentials",[a.INVALID_KID]:"Token has kid claim that cannot be matched with any known Google certificate. This usually indicates that Google certificates have expired and user has to reauthenticate."};class c extends Error{reason;static fromError(e,t){let r=new c(t);return i(r,e),r}isInvalidTokenError=!0;constructor(e){super(`${e}: ${o[e]}`),this.reason=e,Object.setPrototypeOf(this,c.prototype)}}t.InvalidTokenError=c},14491:(e,t,r)=>{let a,n;r.d(t,{MF:()=>N,j6:()=>R,xZ:()=>K,om:()=>T,Sx:()=>U,Dk:()=>M,Wp:()=>J,KO:()=>L});var i=r(4226),s=r(54060),o=r(63187);let c=(e,t)=>t.some(t=>e instanceof t),d=new WeakMap,l=new WeakMap,h=new WeakMap,p=new WeakMap,u=new WeakMap,f={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return l.get(e);if("objectStoreNames"===t)return e.objectStoreNames||h.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return y(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function y(e){if(e instanceof IDBRequest){let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("success",n),e.removeEventListener("error",i)},n=()=>{t(y(e.result)),a()},i=()=>{r(e.error),a()};e.addEventListener("success",n),e.addEventListener("error",i)});return t.then(t=>{t instanceof IDBCursor&&d.set(t,e)}).catch(()=>{}),u.set(t,e),t}if(p.has(e))return p.get(e);let t=function(e){if("function"==typeof e)return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(n||(n=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(w(this),t),y(d.get(this))}:function(...t){return y(e.apply(w(this),t))}:function(t,...r){let a=e.call(w(this),t,...r);return h.set(a,t.sort?t.sort():[t]),y(a)};return(e instanceof IDBTransaction&&function(e){if(l.has(e))return;let t=new Promise((t,r)=>{let a=()=>{e.removeEventListener("complete",n),e.removeEventListener("error",i),e.removeEventListener("abort",i)},n=()=>{t(),a()},i=()=>{r(e.error||new DOMException("AbortError","AbortError")),a()};e.addEventListener("complete",n),e.addEventListener("error",i),e.addEventListener("abort",i)});l.set(e,t)}(e),c(e,a||(a=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])))?new Proxy(e,f):e}(e);return t!==e&&(p.set(e,t),u.set(t,e)),t}let w=e=>u.get(e),m=["get","getKey","getAll","getAllKeys","count"],g=["put","add","delete","clear"],E=new Map;function b(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(E.get(t))return E.get(t);let r=t.replace(/FromIndex$/,""),a=t!==r,n=g.includes(r);if(!(r in(a?IDBIndex:IDBObjectStore).prototype)||!(n||m.includes(r)))return;let i=async function(e,...t){let i=this.transaction(e,n?"readwrite":"readonly"),s=i.store;return a&&(s=s.index(t.shift())),(await Promise.all([s[r](...t),n&&i.done]))[0]};return E.set(t,i),i}f=(e=>({...e,get:(t,r,a)=>b(t,r)||e.get(t,r,a),has:(t,r)=>!!b(t,r)||e.has(t,r)}))(f);class A{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(!function(e){let t=e.getComponent();return(null==t?void 0:t.type)==="VERSION"}(e))return null;{let t=e.getImmediate();return`${t.library}/${t.version}`}}).filter(e=>e).join(" ")}}let S="@firebase/app",_="0.10.13",v=new s.Vy("@firebase/app"),I="[DEFAULT]",C={[S]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/data-connect":"fire-data-connect","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","@firebase/vertexai-preview":"fire-vertex","fire-js":"fire-js",firebase:"fire-js-all"},H=new Map,k=new Map,D=new Map;function P(e,t){try{e.container.addComponent(t)}catch(r){v.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,r)}}function T(e){let t=e.name;if(D.has(t))return v.debug(`There were multiple attempts to register component ${t}.`),!1;for(let r of(D.set(t,e),H.values()))P(r,e);for(let t of k.values())P(t,e);return!0}function R(e,t){let r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function K(e){return void 0!==e.settings}let O=new o.FA("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class W{constructor(e,t,r){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new i.uA("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw O.create("app-deleted",{appName:this._name})}}let N="10.14.1";function J(e,t={}){let r=e;"object"!=typeof t&&(t={name:t});let a=Object.assign({name:I,automaticDataCollectionEnabled:!1},t),n=a.name;if("string"!=typeof n||!n)throw O.create("bad-app-name",{appName:String(n)});if(r||(r=(0,o.T9)()),!r)throw O.create("no-options");let s=H.get(n);if(s)if((0,o.bD)(r,s.options)&&(0,o.bD)(a,s.config))return s;else throw O.create("duplicate-app",{appName:n});let c=new i.h1(n);for(let e of D.values())c.addComponent(e);let d=new W(r,a,c);return H.set(n,d),d}function U(e=I){let t=H.get(e);if(!t&&e===I&&(0,o.T9)())return J();if(!t)throw O.create("no-app",{appName:e});return t}function M(){return Array.from(H.values())}async function x(e){let t=!1,r=e.name;H.has(r)?(t=!0,H.delete(r)):k.has(r)&&0>=e.decRefCount()&&(k.delete(r),t=!0),t&&(await Promise.all(e.container.getProviders().map(e=>e.delete())),e.isDeleted=!0)}function L(e,t,r){var a;let n=null!=(a=C[e])?a:e;r&&(n+=`-${r}`);let s=n.match(/\s|\//),o=t.match(/\s|\//);if(s||o){let e=[`Unable to register library "${n}" with version "${t}":`];s&&e.push(`library name "${n}" contains illegal characters (whitespace or "/")`),s&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),v.warn(e.join(" "));return}T(new i.uA(`${n}-version`,()=>({library:n,version:t}),"VERSION"))}let B="firebase-heartbeat-store",j=null;function $(){return j||(j=(function(e,t,{blocked:r,upgrade:a,blocking:n,terminated:i}={}){let s=indexedDB.open(e,1),o=y(s);return a&&s.addEventListener("upgradeneeded",e=>{a(y(s.result),e.oldVersion,e.newVersion,y(s.transaction),e)}),r&&s.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),o.then(e=>{i&&e.addEventListener("close",()=>i()),n&&e.addEventListener("versionchange",e=>n(e.oldVersion,e.newVersion,e))}).catch(()=>{}),o})("firebase-heartbeat-database",0,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(B)}catch(e){console.warn(e)}}}).catch(e=>{throw O.create("idb-open",{originalErrorMessage:e.message})})),j}async function F(e){try{let t=(await $()).transaction(B),r=await t.objectStore(B).get(G(e));return await t.done,r}catch(e){if(e instanceof o.g)v.warn(e.message);else{let t=O.create("idb-get",{originalErrorMessage:null==e?void 0:e.message});v.warn(t.message)}}}async function V(e,t){try{let r=(await $()).transaction(B,"readwrite"),a=r.objectStore(B);await a.put(t,G(e)),await r.done}catch(e){if(e instanceof o.g)v.warn(e.message);else{let t=O.create("idb-set",{originalErrorMessage:null==e?void 0:e.message});v.warn(t.message)}}}function G(e){return`${e.name}!${e.options.appId}`}class z{constructor(e){this.container=e,this._heartbeatsCache=null;let t=this.container.getProvider("app").getImmediate();this._storage=new Y(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){var e,t;try{let r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),a=X();if((null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null&&(this._heartbeatsCache=await this._heartbeatsCachePromise,(null==(t=this._heartbeatsCache)?void 0:t.heartbeats)==null)||this._heartbeatsCache.lastSentHeartbeatDate===a||this._heartbeatsCache.heartbeats.some(e=>e.date===a))return;return this._heartbeatsCache.heartbeats.push({date:a,agent:r}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter(e=>{let t=new Date(e.date).valueOf();return Date.now()-t<=2592e6}),this._storage.overwrite(this._heartbeatsCache)}catch(e){v.warn(e)}}async getHeartbeatsHeader(){var e;try{if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,(null==(e=this._heartbeatsCache)?void 0:e.heartbeats)==null||0===this._heartbeatsCache.heartbeats.length)return"";let t=X(),{heartbeatsToSend:r,unsentEntries:a}=function(e,t=1024){let r=[],a=e.slice();for(let n of e){let e=r.find(e=>e.agent===n.agent);if(e){if(e.dates.push(n.date),q(r)>t){e.dates.pop();break}}else if(r.push({agent:n.agent,dates:[n.date]}),q(r)>t){r.pop();break}a=a.slice(1)}return{heartbeatsToSend:r,unsentEntries:a}}(this._heartbeatsCache.heartbeats),n=(0,o.Uj)(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,a.length>0?(this._heartbeatsCache.heartbeats=a,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),n}catch(e){return v.warn(e),""}}}function X(){return new Date().toISOString().substring(0,10)}class Y{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!(0,o.zW)()&&(0,o.eX)().then(()=>!0).catch(()=>!1)}async read(){if(!await this._canUseIndexedDBPromise)return{heartbeats:[]};{let e=await F(this.app);return(null==e?void 0:e.heartbeats)?e:{heartbeats:[]}}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return V(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){let r=await this.read();return V(this.app,{lastSentHeartbeatDate:null!=(t=e.lastSentHeartbeatDate)?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function q(e){return(0,o.Uj)(JSON.stringify({version:2,heartbeats:e})).length}T(new i.uA("platform-logger",e=>new A(e),"PRIVATE")),T(new i.uA("heartbeat",e=>new z(e),"PRIVATE")),L(S,_,""),L(S,_,"esm2017"),L("fire-js","")},54060:(e,t,r)=>{var a;r.d(t,{$b:()=>a,Vy:()=>d});let n=[];!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(a||(a={}));let i={debug:a.DEBUG,verbose:a.VERBOSE,info:a.INFO,warn:a.WARN,error:a.ERROR,silent:a.SILENT},s=a.INFO,o={[a.DEBUG]:"log",[a.VERBOSE]:"log",[a.INFO]:"info",[a.WARN]:"warn",[a.ERROR]:"error"},c=(e,t,...r)=>{if(t<e.logLevel)return;let a=new Date().toISOString(),n=o[t];if(n)console[n](`[${a}]  ${e.name}:`,...r);else throw Error(`Attempted to log a message with an invalid logType (value: ${t})`)};class d{constructor(e){this.name=e,this._logLevel=s,this._logHandler=c,this._userLogHandler=null,n.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in a))throw TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?i[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,a.DEBUG,...e),this._logHandler(this,a.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,a.VERBOSE,...e),this._logHandler(this,a.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,a.INFO,...e),this._logHandler(this,a.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,a.WARN,...e),this._logHandler(this,a.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,a.ERROR,...e),this._logHandler(this,a.ERROR,...e)}}},63187:(e,t,r)=>{r.d(t,{Am:()=>R,FA:()=>k,I9:()=>K,Im:()=>P,Ku:()=>U,T9:()=>w,Tj:()=>y,Uj:()=>d,XA:()=>m,ZQ:()=>E,bD:()=>function e(t,r){if(t===r)return!0;let a=Object.keys(t),n=Object.keys(r);for(let i of a){if(!n.includes(i))return!1;let a=t[i],s=r[i];if(T(a)&&T(s)){if(!e(a,s))return!1}else if(a!==s)return!1}for(let e of n)if(!a.includes(e))return!1;return!0},c1:()=>A,cY:()=>g,eX:()=>C,g:()=>H,hp:()=>O,jZ:()=>b,lT:()=>v,lV:()=>_,sr:()=>S,tD:()=>W,u:()=>l,zW:()=>I});var a=r(37811);let n=function(e){let t=[],r=0;for(let a=0;a<e.length;a++){let n=e.charCodeAt(a);n<128?t[r++]=n:(n<2048?t[r++]=n>>6|192:((64512&n)==55296&&a+1<e.length&&(64512&e.charCodeAt(a+1))==56320?(n=65536+((1023&n)<<10)+(1023&e.charCodeAt(++a)),t[r++]=n>>18|240,t[r++]=n>>12&63|128):t[r++]=n>>12|224,t[r++]=n>>6&63|128),t[r++]=63&n|128)}return t},i=function(e){let t=[],r=0,a=0;for(;r<e.length;){let n=e[r++];if(n<128)t[a++]=String.fromCharCode(n);else if(n>191&&n<224){let i=e[r++];t[a++]=String.fromCharCode((31&n)<<6|63&i)}else if(n>239&&n<365){let i=e[r++],s=((7&n)<<18|(63&i)<<12|(63&e[r++])<<6|63&e[r++])-65536;t[a++]=String.fromCharCode(55296+(s>>10)),t[a++]=String.fromCharCode(56320+(1023&s))}else{let i=e[r++],s=e[r++];t[a++]=String.fromCharCode((15&n)<<12|(63&i)<<6|63&s)}}return t.join("")},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();let r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,a=[];for(let t=0;t<e.length;t+=3){let n=e[t],i=t+1<e.length,s=i?e[t+1]:0,o=t+2<e.length,c=o?e[t+2]:0,d=n>>2,l=(3&n)<<4|s>>4,h=(15&s)<<2|c>>6,p=63&c;!o&&(p=64,i||(h=64)),a.push(r[d],r[l],r[h],r[p])}return a.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(n(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):i(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();let r=t?this.charToByteMapWebSafe_:this.charToByteMap_,a=[];for(let t=0;t<e.length;){let n=r[e.charAt(t++)],i=t<e.length?r[e.charAt(t)]:0,s=++t<e.length?r[e.charAt(t)]:64,c=++t<e.length?r[e.charAt(t)]:64;if(++t,null==n||null==i||null==s||null==c)throw new o;let d=n<<2|i>>4;if(a.push(d),64!==s){let e=i<<4&240|s>>2;if(a.push(e),64!==c){let e=s<<6&192|c;a.push(e)}}}return a},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}let c=function(e){let t=n(e);return s.encodeByteArray(t,!0)},d=function(e){return c(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null},h=()=>(function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==r.g)return r.g;throw Error("Unable to locate global object.")})().__FIREBASE_DEFAULTS__,p=()=>{if(void 0===a||void 0===a.env)return;let e=a.env.__FIREBASE_DEFAULTS__;if(e)return JSON.parse(e)},u=()=>{let e;if("undefined"==typeof document)return;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(e){return}let t=e&&l(e[1]);return t&&JSON.parse(t)},f=()=>{try{return h()||p()||u()}catch(e){console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${e}`);return}},y=e=>{var t,r;return null==(r=null==(t=f())?void 0:t.emulatorHosts)?void 0:r[e]},w=()=>{var e;return null==(e=f())?void 0:e.config},m=e=>{var t;return null==(t=f())?void 0:t[`_${e}`]};class g{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"==typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function E(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function b(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(E())}function A(){return"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent}function S(){let e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function _(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function v(){let e=E();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}function I(){try{return"object"==typeof indexedDB}catch(e){return!1}}function C(){return new Promise((e,t)=>{try{let r=!0,a="validate-browser-context-for-indexeddb-analytics-module",n=self.indexedDB.open(a);n.onsuccess=()=>{n.result.close(),r||self.indexedDB.deleteDatabase(a),e(!0)},n.onupgradeneeded=()=>{r=!1},n.onerror=()=>{var e;t((null==(e=n.error)?void 0:e.message)||"")}}catch(e){t(e)}})}class H extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,H.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,k.prototype.create)}}class k{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e,...t){var r,a;let n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],o=s?(r=s,a=n,r.replace(D,(e,t)=>{let r=a[t];return null!=r?String(r):`<${t}?>`})):"Error",c=`${this.serviceName}: ${o} (${i}).`;return new H(i,c,n)}}let D=/\{\$([^}]+)}/g;function P(e){for(let t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function T(e){return null!==e&&"object"==typeof e}function R(e){let t=[];for(let[r,a]of Object.entries(e))Array.isArray(a)?a.forEach(e=>{t.push(encodeURIComponent(r)+"="+encodeURIComponent(e))}):t.push(encodeURIComponent(r)+"="+encodeURIComponent(a));return t.length?"&"+t.join("&"):""}function K(e){let t={};return e.replace(/^\?/,"").split("&").forEach(e=>{if(e){let[r,a]=e.split("=");t[decodeURIComponent(r)]=decodeURIComponent(a)}}),t}function O(e){let t=e.indexOf("?");if(!t)return"";let r=e.indexOf("#",t);return e.substring(t,r>0?r:void 0)}function W(e,t){let r=new N(e,t);return r.subscribe.bind(r)}class N{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then(()=>{e(this)}).catch(e=>{this.error(e)})}next(e){this.forEachObserver(t=>{t.next(e)})}error(e){this.forEachObserver(t=>{t.error(e)}),this.close(e)}complete(){this.forEachObserver(e=>{e.complete()}),this.close()}subscribe(e,t,r){let a;if(void 0===e&&void 0===t&&void 0===r)throw Error("Missing Observer.");void 0===(a=!function(e,t){if("object"!=typeof e||null===e)return!1;for(let r of t)if(r in e&&"function"==typeof e[r])return!0;return!1}(e,["next","error","complete"])?{next:e,error:t,complete:r}:e).next&&(a.next=J),void 0===a.error&&(a.error=J),void 0===a.complete&&(a.complete=J);let n=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(()=>{try{this.finalError?a.error(this.finalError):a.complete()}catch(e){}}),this.observers.push(a),n}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then(()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}})}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then(()=>{this.observers=void 0,this.onNoObservers=void 0}))}}function J(){}function U(e){return e&&e._delegate?e._delegate:e}},68642:(e,t,r)=>{t.$s=c;let a=r(94851),n=r(12818);class i{cacheMap={};constructor(){}get(e){return this.cacheMap[e]?this.cacheMap[e]:e}set(e,t){this.cacheMap={[e]:t}}}let s=new i,o=new i;async function c({serverIdToken:e,refreshTokenUrl:t,checkRevoked:r}){if(!e)return null;let i=s.get(e),o=(0,a.decodeJwt)(i),c=o?.exp??0;if(!r&&c>Date.now()/1e3)return i||e;let d=await h(t);if(!d?.idToken)throw new n.AuthError(n.AuthErrorCode.INTERNAL_ERROR,"Refresh token endpoint returned invalid response. This URL should point to endpoint exposed by the middleware and configured using refreshTokenPath option");return s.set(e,d.idToken),d.idToken}async function d(e,t,r){let a=await l(e);return new n.AuthError(n.AuthErrorCode.INTERNAL_ERROR,`next-firebase-auth-edge: Internal request to ${r?.method??"GET"} ${t.toString()} has failed: ${a}`)}function l(e){let t=e.headers.get("content-type");return t&&-1!==t.indexOf("application/json")?e.json():e.text()}async function h(e,t){let r=await fetch(e,{...t,headers:{...t?.headers,Accept:"application/json","Content-Type":"application/json"}});if(!r.ok)throw await d(r,e,t);return l(r)}},87254:(e,t,r)=>{r.d(t,{xI:()=>a.o,gz:()=>a.U,oM:()=>a.q,hK:()=>a.ae,CI:()=>a.C});var a=r(83345);r(14491),r(63187),r(54060),r(4226)},89696:(e,t,r)=>{r.d(t,{Dk:()=>a.Dk,Sx:()=>a.Sx,Wp:()=>a.Wp});var a=r(14491);(0,a.KO)("firebase","10.14.1","app")},94851:(e,t,r)=>{let a,n,i;r.r(t),r.d(t,{CompactEncrypt:()=>tA,CompactSign:()=>tv,EmbeddedJWK:()=>tO,EncryptJWT:()=>tP,FlattenedEncrypt:()=>tn,FlattenedSign:()=>t_,GeneralEncrypt:()=>ts,GeneralSign:()=>tC,SignJWT:()=>tD,UnsecuredJWT:()=>tF,base64url:()=>o,calculateJwkThumbprint:()=>tR,calculateJwkThumbprintUri:()=>tK,compactDecrypt:()=>e4,compactVerify:()=>th,createLocalJWKSet:()=>tM,createRemoteJWKSet:()=>tj,cryptoRuntime:()=>t1,decodeJwt:()=>tX,decodeProtectedHeader:()=>tz,errors:()=>s,experimental_jwksCache:()=>t$,exportJWK:()=>tr,exportPKCS8:()=>tt,exportSPKI:()=>te,flattenedDecrypt:()=>e6,flattenedVerify:()=>tl,generalDecrypt:()=>e3,generalVerify:()=>tp,generateKeyPair:()=>tQ,generateSecret:()=>t0,importJWK:()=>ej,importPKCS8:()=>eB,importSPKI:()=>ex,importX509:()=>eL,jwksCache:()=>tL,jwtDecrypt:()=>tb,jwtVerify:()=>tE});var s={};r.r(s),r.d(s,{JOSEAlgNotAllowed:()=>C,JOSEError:()=>_,JOSENotSupported:()=>H,JWEDecryptionFailed:()=>k,JWEInvalid:()=>D,JWKInvalid:()=>R,JWKSInvalid:()=>K,JWKSMultipleMatchingKeys:()=>W,JWKSNoMatchingKey:()=>O,JWKSTimeout:()=>N,JWSInvalid:()=>P,JWSSignatureVerificationFailed:()=>J,JWTClaimValidationFailed:()=>v,JWTExpired:()=>I,JWTInvalid:()=>T});var o={};r.r(o),r.d(o,{decode:()=>tG,encode:()=>tV});let c=crypto,d=e=>e instanceof CryptoKey,l=async(e,t)=>{let r=`SHA-${e.slice(-3)}`;return new Uint8Array(await c.subtle.digest(r,t))},h=new TextEncoder,p=new TextDecoder;function u(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}function f(e,t,r){if(t<0||t>=0x100000000)throw RangeError(`value must be >= 0 and <= ${0x100000000-1}. Received ${t}`);e.set([t>>>24,t>>>16,t>>>8,255&t],r)}function y(e){let t=Math.floor(e/0x100000000),r=new Uint8Array(8);return f(r,t,0),f(r,e%0x100000000,4),r}function w(e){let t=new Uint8Array(4);return f(t,e),t}function m(e){return u(w(e.length),e)}async function g(e,t,r){let a=Math.ceil((t>>3)/32),n=new Uint8Array(32*a);for(let t=0;t<a;t++){let a=new Uint8Array(4+e.length+r.length);a.set(w(t+1)),a.set(e,4),a.set(r,4+e.length),n.set(await l("sha256",a),32*t)}return n.slice(0,t>>3)}let E=e=>{let t=e;"string"==typeof t&&(t=h.encode(t));let r=[];for(let e=0;e<t.length;e+=32768)r.push(String.fromCharCode.apply(null,t.subarray(e,e+32768)));return btoa(r.join(""))},b=e=>E(e).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_"),A=e=>{let t=atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r},S=e=>{let t=e;t instanceof Uint8Array&&(t=p.decode(t)),t=t.replace(/-/g,"+").replace(/_/g,"/").replace(/\s/g,"");try{return A(t)}catch{throw TypeError("The input to be decoded is not correctly encoded.")}};class _ extends Error{constructor(e,t){super(e,t),this.code="ERR_JOSE_GENERIC",this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}_.code="ERR_JOSE_GENERIC";class v extends _{constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.code="ERR_JWT_CLAIM_VALIDATION_FAILED",this.claim=r,this.reason=a,this.payload=t}}v.code="ERR_JWT_CLAIM_VALIDATION_FAILED";class I extends _{constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.code="ERR_JWT_EXPIRED",this.claim=r,this.reason=a,this.payload=t}}I.code="ERR_JWT_EXPIRED";class C extends _{constructor(){super(...arguments),this.code="ERR_JOSE_ALG_NOT_ALLOWED"}}C.code="ERR_JOSE_ALG_NOT_ALLOWED";class H extends _{constructor(){super(...arguments),this.code="ERR_JOSE_NOT_SUPPORTED"}}H.code="ERR_JOSE_NOT_SUPPORTED";class k extends _{constructor(e="decryption operation failed",t){super(e,t),this.code="ERR_JWE_DECRYPTION_FAILED"}}k.code="ERR_JWE_DECRYPTION_FAILED";class D extends _{constructor(){super(...arguments),this.code="ERR_JWE_INVALID"}}D.code="ERR_JWE_INVALID";class P extends _{constructor(){super(...arguments),this.code="ERR_JWS_INVALID"}}P.code="ERR_JWS_INVALID";class T extends _{constructor(){super(...arguments),this.code="ERR_JWT_INVALID"}}T.code="ERR_JWT_INVALID";class R extends _{constructor(){super(...arguments),this.code="ERR_JWK_INVALID"}}R.code="ERR_JWK_INVALID";class K extends _{constructor(){super(...arguments),this.code="ERR_JWKS_INVALID"}}K.code="ERR_JWKS_INVALID";class O extends _{constructor(e="no applicable key found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_NO_MATCHING_KEY"}}O.code="ERR_JWKS_NO_MATCHING_KEY";class W extends _{constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t),this.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS"}}Symbol.asyncIterator,W.code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";class N extends _{constructor(e="request timed out",t){super(e,t),this.code="ERR_JWKS_TIMEOUT"}}N.code="ERR_JWKS_TIMEOUT";class J extends _{constructor(e="signature verification failed",t){super(e,t),this.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED"}}J.code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";let U=c.getRandomValues.bind(c);function M(e){switch(e){case"A128GCM":case"A128GCMKW":case"A192GCM":case"A192GCMKW":case"A256GCM":case"A256GCMKW":return 96;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return 128;default:throw new H(`Unsupported JWE Algorithm: ${e}`)}}let x=e=>U(new Uint8Array(M(e)>>3)),L=(e,t)=>{if(t.length<<3!==M(e))throw new D("Invalid Initialization Vector length")},B=(e,t)=>{let r=e.byteLength<<3;if(r!==t)throw new D(`Invalid Content Encryption Key length. Expected ${t} bits, got ${r} bits`)},j=(e,t)=>{if(!(e instanceof Uint8Array))throw TypeError("First argument must be a buffer");if(!(t instanceof Uint8Array))throw TypeError("Second argument must be a buffer");if(e.length!==t.length)throw TypeError("Input buffers must have the same length");let r=e.length,a=0,n=-1;for(;++n<r;)a|=e[n]^t[n];return 0===a};function $(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function F(e,t){return e.name===t}function V(e){return parseInt(e.name.slice(4),10)}function G(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}}function z(e,t,...r){switch(t){case"A128GCM":case"A192GCM":case"A256GCM":{if(!F(e.algorithm,"AES-GCM"))throw $("AES-GCM");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw $(r,"algorithm.length");break}case"A128KW":case"A192KW":case"A256KW":{if(!F(e.algorithm,"AES-KW"))throw $("AES-KW");let r=parseInt(t.slice(1,4),10);if(e.algorithm.length!==r)throw $(r,"algorithm.length");break}case"ECDH":switch(e.algorithm.name){case"ECDH":case"X25519":case"X448":break;default:throw $("ECDH, X25519, or X448")}break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":if(!F(e.algorithm,"PBKDF2"))throw $("PBKDF2");break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":{if(!F(e.algorithm,"RSA-OAEP"))throw $("RSA-OAEP");let r=parseInt(t.slice(9),10)||1;if(V(e.algorithm.hash)!==r)throw $(`SHA-${r}`,"algorithm.hash");break}default:throw TypeError("CryptoKey does not support this operation")}G(e,r)}function X(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let Y=(e,...t)=>X("Key must be ",e,...t);function q(e,t,...r){return X(`Key for the ${e} algorithm must be `,t,...r)}let Z=e=>!!d(e)||e?.[Symbol.toStringTag]==="KeyObject",Q=["CryptoKey"];async function ee(e,t,r,a,n,i){let s,o;if(!(t instanceof Uint8Array))throw TypeError(Y(t,"Uint8Array"));let d=parseInt(e.slice(1,4),10),l=await c.subtle.importKey("raw",t.subarray(d>>3),"AES-CBC",!1,["decrypt"]),h=await c.subtle.importKey("raw",t.subarray(0,d>>3),{hash:`SHA-${d<<1}`,name:"HMAC"},!1,["sign"]),p=u(i,a,r,y(i.length<<3)),f=new Uint8Array((await c.subtle.sign("HMAC",h,p)).slice(0,d>>3));try{s=j(n,f)}catch{}if(!s)throw new k;try{o=new Uint8Array(await c.subtle.decrypt({iv:a,name:"AES-CBC"},l,r))}catch{}if(!o)throw new k;return o}async function et(e,t,r,a,n,i){let s;t instanceof Uint8Array?s=await c.subtle.importKey("raw",t,"AES-GCM",!1,["decrypt"]):(z(t,e,"decrypt"),s=t);try{return new Uint8Array(await c.subtle.decrypt({additionalData:i,iv:a,name:"AES-GCM",tagLength:128},s,u(r,n)))}catch{throw new k}}let er=async(e,t,r,a,n,i)=>{if(!d(t)&&!(t instanceof Uint8Array))throw TypeError(Y(t,...Q,"Uint8Array"));if(!a)throw new D("JWE Initialization Vector missing");if(!n)throw new D("JWE Authentication Tag missing");switch(L(e,a),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return t instanceof Uint8Array&&B(t,parseInt(e.slice(-3),10)),ee(e,t,r,a,n,i);case"A128GCM":case"A192GCM":case"A256GCM":return t instanceof Uint8Array&&B(t,parseInt(e.slice(1,4),10)),et(e,t,r,a,n,i);default:throw new H("Unsupported JWE Content Encryption Algorithm")}},ea=(...e)=>{let t,r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0};function en(e){if("object"!=typeof e||null===e||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}let ei=[{hash:"SHA-256",name:"HMAC"},!0,["sign"]];function es(e,t){if(e.algorithm.length!==parseInt(t.slice(1,4),10))throw TypeError(`Invalid key size for alg: ${t}`)}function eo(e,t,r){if(d(e))return z(e,t,r),e;if(e instanceof Uint8Array)return c.subtle.importKey("raw",e,"AES-KW",!0,[r]);throw TypeError(Y(e,...Q,"Uint8Array"))}let ec=async(e,t,r)=>{let a=await eo(t,e,"wrapKey");es(a,e);let n=await c.subtle.importKey("raw",r,...ei);return new Uint8Array(await c.subtle.wrapKey("raw",n,a,"AES-KW"))},ed=async(e,t,r)=>{let a=await eo(t,e,"unwrapKey");es(a,e);let n=await c.subtle.unwrapKey("raw",r,a,"AES-KW",...ei);return new Uint8Array(await c.subtle.exportKey("raw",n))};async function el(e,t,r,a,n=new Uint8Array(0),i=new Uint8Array(0)){let s;if(!d(e))throw TypeError(Y(e,...Q));if(z(e,"ECDH"),!d(t))throw TypeError(Y(t,...Q));z(t,"ECDH","deriveBits");let o=u(m(h.encode(r)),m(n),m(i),w(a));return s="X25519"===e.algorithm.name?256:"X448"===e.algorithm.name?448:Math.ceil(parseInt(e.algorithm.namedCurve.substr(-3),10)/8)<<3,g(new Uint8Array(await c.subtle.deriveBits({name:e.algorithm.name,public:e},t,s)),a,o)}async function eh(e){if(!d(e))throw TypeError(Y(e,...Q));return c.subtle.generateKey(e.algorithm,!0,["deriveBits"])}function ep(e){if(!d(e))throw TypeError(Y(e,...Q));return["P-256","P-384","P-521"].includes(e.algorithm.namedCurve)||"X25519"===e.algorithm.name||"X448"===e.algorithm.name}async function eu(e,t,r,a){if(!(e instanceof Uint8Array)||e.length<8)throw new D("PBES2 Salt Input must be 8 or more octets");let n=u(h.encode(t),new Uint8Array([0]),e),i=parseInt(t.slice(13,16),10),s={hash:`SHA-${t.slice(8,11)}`,iterations:r,name:"PBKDF2",salt:n},o=await function(e,t){if(e instanceof Uint8Array)return c.subtle.importKey("raw",e,"PBKDF2",!1,["deriveBits"]);if(d(e))return z(e,t,"deriveBits","deriveKey"),e;throw TypeError(Y(e,...Q,"Uint8Array"))}(a,t);if(o.usages.includes("deriveBits"))return new Uint8Array(await c.subtle.deriveBits(s,o,i));if(o.usages.includes("deriveKey"))return c.subtle.deriveKey(s,o,{length:i,name:"AES-KW"},!1,["wrapKey","unwrapKey"]);throw TypeError('PBKDF2 key "usages" must include "deriveBits" or "deriveKey"')}let ef=async(e,t,r,a=2048,n=U(new Uint8Array(16)))=>{let i=await eu(n,e,a,t);return{encryptedKey:await ec(e.slice(-6),i,r),p2c:a,p2s:b(n)}},ey=async(e,t,r,a,n)=>{let i=await eu(n,e,a,t);return ed(e.slice(-6),i,r)};function ew(e){switch(e){case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":return"RSA-OAEP";default:throw new H(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let em=(e,t)=>{if(e.startsWith("RS")||e.startsWith("PS")){let{modulusLength:r}=t.algorithm;if("number"!=typeof r||r<2048)throw TypeError(`${e} requires key modulusLength to be 2048 bits or larger`)}},eg=async(e,t,r)=>{if(!d(t))throw TypeError(Y(t,...Q));if(z(t,e,"encrypt","wrapKey"),em(e,t),t.usages.includes("encrypt"))return new Uint8Array(await c.subtle.encrypt(ew(e),t,r));if(t.usages.includes("wrapKey")){let a=await c.subtle.importKey("raw",r,...ei);return new Uint8Array(await c.subtle.wrapKey("raw",a,t,ew(e)))}throw TypeError('RSA-OAEP key "usages" must include "encrypt" or "wrapKey" for this operation')},eE=async(e,t,r)=>{if(!d(t))throw TypeError(Y(t,...Q));if(z(t,e,"decrypt","unwrapKey"),em(e,t),t.usages.includes("decrypt"))return new Uint8Array(await c.subtle.decrypt(ew(e),t,r));if(t.usages.includes("unwrapKey")){let a=await c.subtle.unwrapKey("raw",r,t,ew(e),...ei);return new Uint8Array(await c.subtle.exportKey("raw",a))}throw TypeError('RSA-OAEP key "usages" must include "decrypt" or "unwrapKey" for this operation')};function eb(e){return en(e)&&"string"==typeof e.kty}let eA=async e=>{if(!e.alg)throw TypeError('"alg" argument is required when "jwk.alg" is not present');let{algorithm:t,keyUsages:r}=function(e){let t,r;switch(e.kty){case"RSA":switch(e.alg){case"PS256":case"PS384":case"PS512":t={name:"RSA-PSS",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RS256":case"RS384":case"RS512":t={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.alg.slice(-3)}`},r=e.d?["sign"]:["verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":t={name:"RSA-OAEP",hash:`SHA-${parseInt(e.alg.slice(-3),10)||1}`},r=e.d?["decrypt","unwrapKey"]:["encrypt","wrapKey"];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"EC":switch(e.alg){case"ES256":t={name:"ECDSA",namedCurve:"P-256"},r=e.d?["sign"]:["verify"];break;case"ES384":t={name:"ECDSA",namedCurve:"P-384"},r=e.d?["sign"]:["verify"];break;case"ES512":t={name:"ECDSA",namedCurve:"P-521"},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:"ECDH",namedCurve:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;case"OKP":switch(e.alg){case"Ed25519":t={name:"Ed25519"},r=e.d?["sign"]:["verify"];break;case"EdDSA":t={name:e.crv},r=e.d?["sign"]:["verify"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":t={name:e.crv},r=e.d?["deriveBits"]:[];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}break;default:throw new H('Invalid or unsupported JWK "kty" (Key Type) Parameter value')}return{algorithm:t,keyUsages:r}}(e),a=[t,e.ext??!1,e.key_ops??r],n={...e};return delete n.alg,delete n.use,c.subtle.importKey("jwk",n,...a)},eS=e=>S(e),e_=e=>e?.[Symbol.toStringTag]==="KeyObject",ev=async(e,t,r,a,n=!1)=>{let i=e.get(t);if(i?.[a])return i[a];let s=await eA({...r,alg:a});return n&&Object.freeze(t),i?i[a]=s:e.set(t,{[a]:s}),s},eI={normalizePublicKey:(e,t)=>{if(e_(e)){let r=e.export({format:"jwk"});return(delete r.d,delete r.dp,delete r.dq,delete r.p,delete r.q,delete r.qi,r.k)?eS(r.k):(n||(n=new WeakMap),ev(n,e,r,t))}return eb(e)?e.k?S(e.k):(n||(n=new WeakMap),ev(n,e,e,t,!0)):e},normalizePrivateKey:(e,t)=>{if(e_(e)){let r=e.export({format:"jwk"});return r.k?eS(r.k):(a||(a=new WeakMap),ev(a,e,r,t))}return eb(e)?e.k?S(e.k):(a||(a=new WeakMap),ev(a,e,e,t,!0)):e}};function eC(e){switch(e){case"A128GCM":return 128;case"A192GCM":return 192;case"A256GCM":case"A128CBC-HS256":return 256;case"A192CBC-HS384":return 384;case"A256CBC-HS512":return 512;default:throw new H(`Unsupported JWE Algorithm: ${e}`)}}let eH=e=>U(new Uint8Array(eC(e)>>3)),ek=(e,t)=>{let r=(e.match(/.{1,64}/g)||[]).join("\n");return`-----BEGIN ${t}-----
${r}
-----END ${t}-----`},eD=async(e,t,r)=>{if(!d(r))throw TypeError(Y(r,...Q));if(!r.extractable)throw TypeError("CryptoKey is not extractable");if(r.type!==e)throw TypeError(`key is not a ${e} key`);return ek(E(new Uint8Array(await c.subtle.exportKey(t,r))),`${e.toUpperCase()} KEY`)},eP=e=>eD("public","spki",e),eT=e=>eD("private","pkcs8",e),eR=(e,t,r=0)=>{0===r&&(t.unshift(t.length),t.unshift(6));let a=e.indexOf(t[0],r);if(-1===a)return!1;let n=e.subarray(a,a+t.length);return n.length===t.length&&(n.every((e,r)=>e===t[r])||eR(e,t,a+1))},eK=e=>{switch(!0){case eR(e,[42,134,72,206,61,3,1,7]):return"P-256";case eR(e,[43,129,4,0,34]):return"P-384";case eR(e,[43,129,4,0,35]):return"P-521";case eR(e,[43,101,110]):return"X25519";case eR(e,[43,101,111]):return"X448";case eR(e,[43,101,112]):return"Ed25519";case eR(e,[43,101,113]):return"Ed448";default:throw new H("Invalid or unsupported EC Key Curve or OKP Key Sub Type")}},eO=async(e,t,r,a,n)=>{let i,s,o=new Uint8Array(atob(r.replace(e,"")).split("").map(e=>e.charCodeAt(0))),d="spki"===t;switch(a){case"PS256":case"PS384":case"PS512":i={name:"RSA-PSS",hash:`SHA-${a.slice(-3)}`},s=d?["verify"]:["sign"];break;case"RS256":case"RS384":case"RS512":i={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${a.slice(-3)}`},s=d?["verify"]:["sign"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":i={name:"RSA-OAEP",hash:`SHA-${parseInt(a.slice(-3),10)||1}`},s=d?["encrypt","wrapKey"]:["decrypt","unwrapKey"];break;case"ES256":i={name:"ECDSA",namedCurve:"P-256"},s=d?["verify"]:["sign"];break;case"ES384":i={name:"ECDSA",namedCurve:"P-384"},s=d?["verify"]:["sign"];break;case"ES512":i={name:"ECDSA",namedCurve:"P-521"},s=d?["verify"]:["sign"];break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let e=eK(o);i=e.startsWith("P-")?{name:"ECDH",namedCurve:e}:{name:e},s=d?[]:["deriveBits"];break}case"Ed25519":i={name:"Ed25519"},s=d?["verify"]:["sign"];break;case"EdDSA":i={name:eK(o)},s=d?["verify"]:["sign"];break;default:throw new H('Invalid or unsupported "alg" (Algorithm) value')}return c.subtle.importKey(t,o,i,n?.extractable??!1,s)},eW=(e,t,r)=>eO(/(?:-----(?:BEGIN|END) PRIVATE KEY-----|\s)/g,"pkcs8",e,t,r),eN=(e,t,r)=>eO(/(?:-----(?:BEGIN|END) PUBLIC KEY-----|\s)/g,"spki",e,t,r);function eJ(e){let t=[],r=0;for(;r<e.length;){let a=eU(e.subarray(r));t.push(a),r+=a.byteLength}return t}function eU(e){let t=0,r=31&e[0];if(t++,31===r){for(r=0;e[t]>=128;)r=128*r+e[t]-128,t++;r=128*r+e[t]-128,t++}let a=0;if(e[t]<128)a=e[t],t++;else if(128===a){for(a=0;0!==e[t+a]||0!==e[t+a+1];){if(a>e.byteLength)throw TypeError("invalid indefinite form length");a++}let r=t+a+2;return{byteLength:r,contents:e.subarray(t,t+a),raw:e.subarray(0,r)}}else{let r=127&e[t];t++,a=0;for(let n=0;n<r;n++)a=256*a+e[t],t++}let n=t+a;return{byteLength:n,contents:e.subarray(t,n),raw:e.subarray(0,n)}}let eM=(e,t,r)=>{let a;try{a=ek(function(e){let t=eJ(eJ(eU(e).contents)[0].contents);return E(t[160===t[0].raw[0]?6:5].raw)}(A(e.replace(/(?:-----(?:BEGIN|END) CERTIFICATE-----|\s)/g,""))),"PUBLIC KEY")}catch(e){throw TypeError("Failed to parse the X.509 certificate",{cause:e})}return eN(a,t,r)};async function ex(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PUBLIC KEY-----"))throw TypeError('"spki" must be SPKI formatted string');return eN(e,t,r)}async function eL(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN CERTIFICATE-----"))throw TypeError('"x509" must be X.509 formatted string');return eM(e,t,r)}async function eB(e,t,r){if("string"!=typeof e||0!==e.indexOf("-----BEGIN PRIVATE KEY-----"))throw TypeError('"pkcs8" must be PKCS#8 formatted string');return eW(e,t,r)}async function ej(e,t){if(!en(e))throw TypeError("JWK must be an object");switch(t||(t=e.alg),e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return S(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new H('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return eA({...e,alg:t});default:throw new H('Unsupported "kty" (Key Type) Parameter value')}}let e$=e=>e?.[Symbol.toStringTag],eF=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},eV=(e,t,r,a)=>{if(!(t instanceof Uint8Array)){if(a&&eb(t)){if(function(e){return eb(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&eF(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!Z(t))throw TypeError(q(e,t,...Q,"Uint8Array",a?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${e$(t)} instances for symmetric algorithms must be of type "secret"`)}},eG=(e,t,r,a)=>{if(a&&eb(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&eF(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&eF(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!Z(t))throw TypeError(q(e,t,...Q,a?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${e$(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${e$(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${e$(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${e$(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${e$(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function ez(e,t,r,a){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?eV(t,r,a,e):eG(t,r,a,e)}let eX=ez.bind(void 0,!1),eY=ez.bind(void 0,!0);async function eq(e,t,r,a,n){if(!(r instanceof Uint8Array))throw TypeError(Y(r,"Uint8Array"));let i=parseInt(e.slice(1,4),10),s=await c.subtle.importKey("raw",r.subarray(i>>3),"AES-CBC",!1,["encrypt"]),o=await c.subtle.importKey("raw",r.subarray(0,i>>3),{hash:`SHA-${i<<1}`,name:"HMAC"},!1,["sign"]),d=new Uint8Array(await c.subtle.encrypt({iv:a,name:"AES-CBC"},s,t)),l=u(n,a,d,y(n.length<<3));return{ciphertext:d,tag:new Uint8Array((await c.subtle.sign("HMAC",o,l)).slice(0,i>>3)),iv:a}}async function eZ(e,t,r,a,n){let i;r instanceof Uint8Array?i=await c.subtle.importKey("raw",r,"AES-GCM",!1,["encrypt"]):(z(r,e,"encrypt"),i=r);let s=new Uint8Array(await c.subtle.encrypt({additionalData:n,iv:a,name:"AES-GCM",tagLength:128},i,t)),o=s.slice(-16);return{ciphertext:s.slice(0,-16),tag:o,iv:a}}let eQ=async(e,t,r,a,n)=>{if(!d(r)&&!(r instanceof Uint8Array))throw TypeError(Y(r,...Q,"Uint8Array"));switch(a?L(e,a):a=x(e),e){case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return r instanceof Uint8Array&&B(r,parseInt(e.slice(-3),10)),eq(e,t,r,a,n);case"A128GCM":case"A192GCM":case"A256GCM":return r instanceof Uint8Array&&B(r,parseInt(e.slice(1,4),10)),eZ(e,t,r,a,n);default:throw new H("Unsupported JWE Content Encryption Algorithm")}};async function e0(e,t,r,a){let n=e.slice(0,7),i=await eQ(n,r,t,a,new Uint8Array(0));return{encryptedKey:i.ciphertext,iv:b(i.iv),tag:b(i.tag)}}async function e1(e,t,r,a,n){return er(e.slice(0,7),t,r,a,n,new Uint8Array(0))}async function e2(e,t,r,a,n){switch(eX(e,t,"decrypt"),t=await eI.normalizePrivateKey?.(t,e)||t,e){case"dir":if(void 0!==r)throw new D("Encountered unexpected JWE Encrypted Key");return t;case"ECDH-ES":if(void 0!==r)throw new D("Encountered unexpected JWE Encrypted Key");case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{let n,i;if(!en(a.epk))throw new D('JOSE Header "epk" (Ephemeral Public Key) missing or invalid');if(!ep(t))throw new H("ECDH with the provided key is not allowed or not supported by your javascript runtime");let s=await ej(a.epk,e);if(void 0!==a.apu){if("string"!=typeof a.apu)throw new D('JOSE Header "apu" (Agreement PartyUInfo) invalid');try{n=S(a.apu)}catch{throw new D("Failed to base64url decode the apu")}}if(void 0!==a.apv){if("string"!=typeof a.apv)throw new D('JOSE Header "apv" (Agreement PartyVInfo) invalid');try{i=S(a.apv)}catch{throw new D("Failed to base64url decode the apv")}}let o=await el(s,t,"ECDH-ES"===e?a.enc:e,"ECDH-ES"===e?eC(a.enc):parseInt(e.slice(-5,-2),10),n,i);if("ECDH-ES"===e)return o;if(void 0===r)throw new D("JWE Encrypted Key missing");return ed(e.slice(-6),o,r)}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":if(void 0===r)throw new D("JWE Encrypted Key missing");return eE(e,t,r);case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{let i;if(void 0===r)throw new D("JWE Encrypted Key missing");if("number"!=typeof a.p2c)throw new D('JOSE Header "p2c" (PBES2 Count) missing or invalid');let s=n?.maxPBES2Count||1e4;if(a.p2c>s)throw new D('JOSE Header "p2c" (PBES2 Count) out is of acceptable bounds');if("string"!=typeof a.p2s)throw new D('JOSE Header "p2s" (PBES2 Salt) missing or invalid');try{i=S(a.p2s)}catch{throw new D("Failed to base64url decode the p2s")}return ey(e,t,r,a.p2c,i)}case"A128KW":case"A192KW":case"A256KW":if(void 0===r)throw new D("JWE Encrypted Key missing");return ed(e,t,r);case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{let n,i;if(void 0===r)throw new D("JWE Encrypted Key missing");if("string"!=typeof a.iv)throw new D('JOSE Header "iv" (Initialization Vector) missing or invalid');if("string"!=typeof a.tag)throw new D('JOSE Header "tag" (Authentication Tag) missing or invalid');try{n=S(a.iv)}catch{throw new D("Failed to base64url decode the iv")}try{i=S(a.tag)}catch{throw new D("Failed to base64url decode the tag")}return e1(e,t,r,n,i)}default:throw new H('Invalid or unsupported "alg" (JWE Algorithm) header value')}}let e5=function(e,t,r,a,n){let i;if(void 0!==n.crit&&a?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let s of(i=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!i.has(s))throw new H(`Extension Header Parameter "${s}" is not recognized`);if(void 0===n[s])throw new e(`Extension Header Parameter "${s}" is missing`);if(i.get(s)&&void 0===a[s])throw new e(`Extension Header Parameter "${s}" MUST be integrity protected`)}return new Set(a.crit)},e8=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)};async function e6(e,t,r){let a,n,i,s,o,c,d;if(!en(e))throw new D("Flattened JWE must be an object");if(void 0===e.protected&&void 0===e.header&&void 0===e.unprotected)throw new D("JOSE Header missing");if(void 0!==e.iv&&"string"!=typeof e.iv)throw new D("JWE Initialization Vector incorrect type");if("string"!=typeof e.ciphertext)throw new D("JWE Ciphertext missing or incorrect type");if(void 0!==e.tag&&"string"!=typeof e.tag)throw new D("JWE Authentication Tag incorrect type");if(void 0!==e.protected&&"string"!=typeof e.protected)throw new D("JWE Protected Header incorrect type");if(void 0!==e.encrypted_key&&"string"!=typeof e.encrypted_key)throw new D("JWE Encrypted Key incorrect type");if(void 0!==e.aad&&"string"!=typeof e.aad)throw new D("JWE AAD incorrect type");if(void 0!==e.header&&!en(e.header))throw new D("JWE Shared Unprotected Header incorrect type");if(void 0!==e.unprotected&&!en(e.unprotected))throw new D("JWE Per-Recipient Unprotected Header incorrect type");if(e.protected)try{let t=S(e.protected);a=JSON.parse(p.decode(t))}catch{throw new D("JWE Protected Header is invalid")}if(!ea(a,e.header,e.unprotected))throw new D("JWE Protected, JWE Unprotected Header, and JWE Per-Recipient Unprotected Header Parameter names must be disjoint");let l={...a,...e.header,...e.unprotected};if(e5(D,new Map,r?.crit,a,l),void 0!==l.zip)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:f,enc:y}=l;if("string"!=typeof f||!f)throw new D("missing JWE Algorithm (alg) in JWE Header");if("string"!=typeof y||!y)throw new D("missing JWE Encryption Algorithm (enc) in JWE Header");let w=r&&e8("keyManagementAlgorithms",r.keyManagementAlgorithms),m=r&&e8("contentEncryptionAlgorithms",r.contentEncryptionAlgorithms);if(w&&!w.has(f)||!w&&f.startsWith("PBES2"))throw new C('"alg" (Algorithm) Header Parameter value not allowed');if(m&&!m.has(y))throw new C('"enc" (Encryption Algorithm) Header Parameter value not allowed');if(void 0!==e.encrypted_key)try{n=S(e.encrypted_key)}catch{throw new D("Failed to base64url decode the encrypted_key")}let g=!1;"function"==typeof t&&(t=await t(a,e),g=!0);try{i=await e2(f,t,n,l,r)}catch(e){if(e instanceof TypeError||e instanceof D||e instanceof H)throw e;i=eH(y)}if(void 0!==e.iv)try{s=S(e.iv)}catch{throw new D("Failed to base64url decode the iv")}if(void 0!==e.tag)try{o=S(e.tag)}catch{throw new D("Failed to base64url decode the tag")}let E=h.encode(e.protected??"");c=void 0!==e.aad?u(E,h.encode("."),h.encode(e.aad)):E;try{d=S(e.ciphertext)}catch{throw new D("Failed to base64url decode the ciphertext")}let b={plaintext:await er(y,i,d,s,o,c)};if(void 0!==e.protected&&(b.protectedHeader=a),void 0!==e.aad)try{b.additionalAuthenticatedData=S(e.aad)}catch{throw new D("Failed to base64url decode the aad")}return(void 0!==e.unprotected&&(b.sharedUnprotectedHeader=e.unprotected),void 0!==e.header&&(b.unprotectedHeader=e.header),g)?{...b,key:t}:b}async function e4(e,t,r){if(e instanceof Uint8Array&&(e=p.decode(e)),"string"!=typeof e)throw new D("Compact JWE must be a string or Uint8Array");let{0:a,1:n,2:i,3:s,4:o,length:c}=e.split(".");if(5!==c)throw new D("Invalid Compact JWE");let d=await e6({ciphertext:s,iv:i||void 0,protected:a,tag:o||void 0,encrypted_key:n||void 0},t,r),l={plaintext:d.plaintext,protectedHeader:d.protectedHeader};return"function"==typeof t?{...l,key:d.key}:l}async function e3(e,t,r){if(!en(e))throw new D("General JWE must be an object");if(!Array.isArray(e.recipients)||!e.recipients.every(en))throw new D("JWE Recipients missing or incorrect type");if(!e.recipients.length)throw new D("JWE Recipients has no members");for(let a of e.recipients)try{return await e6({aad:e.aad,ciphertext:e.ciphertext,encrypted_key:a.encrypted_key,header:a.header,iv:e.iv,protected:e.protected,tag:e.tag,unprotected:e.unprotected},t,r)}catch{}throw new k}let e9=Symbol(),e7=async e=>{if(e instanceof Uint8Array)return{kty:"oct",k:b(e)};if(!d(e))throw TypeError(Y(e,...Q,"Uint8Array"));if(!e.extractable)throw TypeError("non-extractable CryptoKey cannot be exported as a JWK");let{ext:t,key_ops:r,alg:a,use:n,...i}=await c.subtle.exportKey("jwk",e);return i};async function te(e){return eP(e)}async function tt(e){return eT(e)}async function tr(e){return e7(e)}async function ta(e,t,r,a,n={}){let i,s,o;switch(eX(e,r,"encrypt"),r=await eI.normalizePublicKey?.(r,e)||r,e){case"dir":o=r;break;case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{if(!ep(r))throw new H("ECDH with the provided key is not allowed or not supported by your javascript runtime");let{apu:c,apv:d}=n,{epk:l}=n;l||(l=(await eh(r)).privateKey);let{x:h,y:p,crv:u,kty:f}=await tr(l),y=await el(r,l,"ECDH-ES"===e?t:e,"ECDH-ES"===e?eC(t):parseInt(e.slice(-5,-2),10),c,d);if(s={epk:{x:h,crv:u,kty:f}},"EC"===f&&(s.epk.y=p),c&&(s.apu=b(c)),d&&(s.apv=b(d)),"ECDH-ES"===e){o=y;break}o=a||eH(t);let w=e.slice(-6);i=await ec(w,y,o);break}case"RSA1_5":case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":o=a||eH(t),i=await eg(e,r,o);break;case"PBES2-HS256+A128KW":case"PBES2-HS384+A192KW":case"PBES2-HS512+A256KW":{o=a||eH(t);let{p2c:c,p2s:d}=n;({encryptedKey:i,...s}=await ef(e,r,o,c,d));break}case"A128KW":case"A192KW":case"A256KW":o=a||eH(t),i=await ec(e,r,o);break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":{o=a||eH(t);let{iv:c}=n;({encryptedKey:i,...s}=await e0(e,r,o,c));break}default:throw new H('Invalid or unsupported "alg" (JWE Algorithm) header value')}return{cek:o,encryptedKey:i,parameters:s}}class tn{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("plaintext must be an instance of Uint8Array");this._plaintext=e}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._sharedUnprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._sharedUnprotectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}async encrypt(e,t){let r,a,n,i,s;if(!this._protectedHeader&&!this._unprotectedHeader&&!this._sharedUnprotectedHeader)throw new D("either setProtectedHeader, setUnprotectedHeader, or sharedUnprotectedHeader must be called before #encrypt()");if(!ea(this._protectedHeader,this._unprotectedHeader,this._sharedUnprotectedHeader))throw new D("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let o={...this._protectedHeader,...this._unprotectedHeader,...this._sharedUnprotectedHeader};if(e5(D,new Map,t?.crit,this._protectedHeader,o),void 0!==o.zip)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.');let{alg:c,enc:d}=o;if("string"!=typeof c||!c)throw new D('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("string"!=typeof d||!d)throw new D('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(this._cek&&("dir"===c||"ECDH-ES"===c))throw TypeError(`setContentEncryptionKey cannot be called with JWE "alg" (Algorithm) Header ${c}`);{let n;({cek:a,encryptedKey:r,parameters:n}=await ta(c,d,e,this._cek,this._keyManagementParameters)),n&&(t&&e9 in t?this._unprotectedHeader?this._unprotectedHeader={...this._unprotectedHeader,...n}:this.setUnprotectedHeader(n):this._protectedHeader?this._protectedHeader={...this._protectedHeader,...n}:this.setProtectedHeader(n))}i=this._protectedHeader?h.encode(b(JSON.stringify(this._protectedHeader))):h.encode(""),this._aad?(s=b(this._aad),n=u(i,h.encode("."),h.encode(s))):n=i;let{ciphertext:l,tag:f,iv:y}=await eQ(d,this._plaintext,a,this._iv,n),w={ciphertext:b(l)};return y&&(w.iv=b(y)),f&&(w.tag=b(f)),r&&(w.encrypted_key=b(r)),s&&(w.aad=s),this._protectedHeader&&(w.protected=p.decode(i)),this._sharedUnprotectedHeader&&(w.unprotected=this._sharedUnprotectedHeader),this._unprotectedHeader&&(w.header=this._unprotectedHeader),w}}class ti{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addRecipient(...e){return this.parent.addRecipient(...e)}encrypt(...e){return this.parent.encrypt(...e)}done(){return this.parent}}class ts{constructor(e){this._recipients=[],this._plaintext=e}addRecipient(e,t){let r=new ti(this,e,{crit:t?.crit});return this._recipients.push(r),r}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setSharedUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setSharedUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}setAdditionalAuthenticatedData(e){return this._aad=e,this}async encrypt(){let e;if(!this._recipients.length)throw new D("at least one recipient must be added");if(1===this._recipients.length){let[e]=this._recipients,t=await new tn(this._plaintext).setAdditionalAuthenticatedData(this._aad).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(e.unprotectedHeader).encrypt(e.key,{...e.options}),r={ciphertext:t.ciphertext,iv:t.iv,recipients:[{}],tag:t.tag};return t.aad&&(r.aad=t.aad),t.protected&&(r.protected=t.protected),t.unprotected&&(r.unprotected=t.unprotected),t.encrypted_key&&(r.recipients[0].encrypted_key=t.encrypted_key),t.header&&(r.recipients[0].header=t.header),r}for(let t=0;t<this._recipients.length;t++){let r=this._recipients[t];if(!ea(this._protectedHeader,this._unprotectedHeader,r.unprotectedHeader))throw new D("JWE Protected, JWE Shared Unprotected and JWE Per-Recipient Header Parameter names must be disjoint");let a={...this._protectedHeader,...this._unprotectedHeader,...r.unprotectedHeader},{alg:n}=a;if("string"!=typeof n||!n)throw new D('JWE "alg" (Algorithm) Header Parameter missing or invalid');if("dir"===n||"ECDH-ES"===n)throw new D('"dir" and "ECDH-ES" alg may only be used with a single recipient');if("string"!=typeof a.enc||!a.enc)throw new D('JWE "enc" (Encryption Algorithm) Header Parameter missing or invalid');if(e){if(e!==a.enc)throw new D('JWE "enc" (Encryption Algorithm) Header Parameter must be the same for all recipients')}else e=a.enc;if(e5(D,new Map,r.options.crit,this._protectedHeader,a),void 0!==a.zip)throw new H('JWE "zip" (Compression Algorithm) Header Parameter is not supported.')}let t=eH(e),r={ciphertext:"",iv:"",recipients:[],tag:""};for(let a=0;a<this._recipients.length;a++){let n=this._recipients[a],i={};r.recipients.push(i);let s=({...this._protectedHeader,...this._unprotectedHeader,...n.unprotectedHeader}).alg.startsWith("PBES2")?2048+a:void 0;if(0===a){let e=await new tn(this._plaintext).setAdditionalAuthenticatedData(this._aad).setContentEncryptionKey(t).setProtectedHeader(this._protectedHeader).setSharedUnprotectedHeader(this._unprotectedHeader).setUnprotectedHeader(n.unprotectedHeader).setKeyManagementParameters({p2c:s}).encrypt(n.key,{...n.options,[e9]:!0});r.ciphertext=e.ciphertext,r.iv=e.iv,r.tag=e.tag,e.aad&&(r.aad=e.aad),e.protected&&(r.protected=e.protected),e.unprotected&&(r.unprotected=e.unprotected),i.encrypted_key=e.encrypted_key,e.header&&(i.header=e.header);continue}let{encryptedKey:o,parameters:c}=await ta(n.unprotectedHeader?.alg||this._protectedHeader?.alg||this._unprotectedHeader?.alg,e,n.key,t,{p2c:s});i.encrypted_key=b(o),(n.unprotectedHeader||c)&&(i.header={...n.unprotectedHeader,...c})}return r}}function to(e,t){let r=`SHA-${e.slice(-3)}`;switch(e){case"HS256":case"HS384":case"HS512":return{hash:r,name:"HMAC"};case"PS256":case"PS384":case"PS512":return{hash:r,name:"RSA-PSS",saltLength:e.slice(-3)>>3};case"RS256":case"RS384":case"RS512":return{hash:r,name:"RSASSA-PKCS1-v1_5"};case"ES256":case"ES384":case"ES512":return{hash:r,name:"ECDSA",namedCurve:t.namedCurve};case"Ed25519":return{name:"Ed25519"};case"EdDSA":return{name:t.name};default:throw new H(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}async function tc(e,t,r){if("sign"===r&&(t=await eI.normalizePrivateKey(t,e)),"verify"===r&&(t=await eI.normalizePublicKey(t,e)),d(t))return!function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!F(e.algorithm,"HMAC"))throw $("HMAC");let r=parseInt(t.slice(2),10);if(V(e.algorithm.hash)!==r)throw $(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!F(e.algorithm,"RSASSA-PKCS1-v1_5"))throw $("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(V(e.algorithm.hash)!==r)throw $(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!F(e.algorithm,"RSA-PSS"))throw $("RSA-PSS");let r=parseInt(t.slice(2),10);if(V(e.algorithm.hash)!==r)throw $(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw $("Ed25519 or Ed448");break;case"Ed25519":if(!F(e.algorithm,"Ed25519"))throw $("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!F(e.algorithm,"ECDSA"))throw $("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw $(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}G(e,r)}(t,e,r),t;if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(Y(t,...Q));return c.subtle.importKey("raw",t,{hash:`SHA-${e.slice(-3)}`,name:"HMAC"},!1,[r])}throw TypeError(Y(t,...Q,"Uint8Array","JSON Web Key"))}let td=async(e,t,r,a)=>{let n=await tc(e,t,"verify");em(e,n);let i=to(e,n.algorithm);try{return await c.subtle.verify(i,n,r,a)}catch{return!1}};async function tl(e,t,r){let a,n;if(!en(e))throw new P("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new P('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new P("JWS Protected Header incorrect type");if(void 0===e.payload)throw new P("JWS Payload missing");if("string"!=typeof e.signature)throw new P("JWS Signature missing or incorrect type");if(void 0!==e.header&&!en(e.header))throw new P("JWS Unprotected Header incorrect type");let i={};if(e.protected)try{let t=S(e.protected);i=JSON.parse(p.decode(t))}catch{throw new P("JWS Protected Header is invalid")}if(!ea(i,e.header))throw new P("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let s={...i,...e.header},o=e5(P,new Map([["b64",!0]]),r?.crit,i,s),c=!0;if(o.has("b64")&&"boolean"!=typeof(c=i.b64))throw new P('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:d}=s;if("string"!=typeof d||!d)throw new P('JWS "alg" (Algorithm) Header Parameter missing or invalid');let l=r&&e8("algorithms",r.algorithms);if(l&&!l.has(d))throw new C('"alg" (Algorithm) Header Parameter value not allowed');if(c){if("string"!=typeof e.payload)throw new P("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new P("JWS Payload must be a string or an Uint8Array instance");let f=!1;"function"==typeof t?(t=await t(i,e),f=!0,eY(d,t,"verify"),eb(t)&&(t=await ej(t,d))):eY(d,t,"verify");let y=u(h.encode(e.protected??""),h.encode("."),"string"==typeof e.payload?h.encode(e.payload):e.payload);try{a=S(e.signature)}catch{throw new P("Failed to base64url decode the signature")}if(!await td(d,t,a,y))throw new J;if(c)try{n=S(e.payload)}catch{throw new P("Failed to base64url decode the payload")}else n="string"==typeof e.payload?h.encode(e.payload):e.payload;let w={payload:n};return(void 0!==e.protected&&(w.protectedHeader=i),void 0!==e.header&&(w.unprotectedHeader=e.header),f)?{...w,key:t}:w}async function th(e,t,r){if(e instanceof Uint8Array&&(e=p.decode(e)),"string"!=typeof e)throw new P("Compact JWS must be a string or Uint8Array");let{0:a,1:n,2:i,length:s}=e.split(".");if(3!==s)throw new P("Invalid Compact JWS");let o=await tl({payload:n,protected:a,signature:i},t,r),c={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...c,key:o.key}:c}async function tp(e,t,r){if(!en(e))throw new P("General JWS must be an object");if(!Array.isArray(e.signatures)||!e.signatures.every(en))throw new P("JWS Signatures missing or incorrect type");for(let a of e.signatures)try{return await tl({header:a.header,payload:e.payload,protected:a.protected,signature:a.signature},t,r)}catch{}throw new J}let tu=e=>Math.floor(e.getTime()/1e3),tf=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,ty=e=>{let t,r=tf.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let a=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*a);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*a);break;case"day":case"days":case"d":t=Math.round(86400*a);break;case"week":case"weeks":case"w":t=Math.round(604800*a);break;default:t=Math.round(0x1e187e0*a)}return"-"===r[1]||"ago"===r[4]?-t:t},tw=e=>e.toLowerCase().replace(/^application\//,""),tm=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),tg=(e,t,r={})=>{let a,n;try{a=JSON.parse(p.decode(t))}catch{}if(!en(a))throw new T("JWT Claims Set must be a top-level JSON object");let{typ:i}=r;if(i&&("string"!=typeof e.typ||tw(e.typ)!==tw(i)))throw new v('unexpected "typ" JWT header value',a,"typ","check_failed");let{requiredClaims:s=[],issuer:o,subject:c,audience:d,maxTokenAge:l}=r,h=[...s];for(let e of(void 0!==l&&h.push("iat"),void 0!==d&&h.push("aud"),void 0!==c&&h.push("sub"),void 0!==o&&h.push("iss"),new Set(h.reverse())))if(!(e in a))throw new v(`missing required "${e}" claim`,a,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(a.iss))throw new v('unexpected "iss" claim value',a,"iss","check_failed");if(c&&a.sub!==c)throw new v('unexpected "sub" claim value',a,"sub","check_failed");if(d&&!tm(a.aud,"string"==typeof d?[d]:d))throw new v('unexpected "aud" claim value',a,"aud","check_failed");switch(typeof r.clockTolerance){case"string":n=ty(r.clockTolerance);break;case"number":n=r.clockTolerance;break;case"undefined":n=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:u}=r,f=tu(u||new Date);if((void 0!==a.iat||l)&&"number"!=typeof a.iat)throw new v('"iat" claim must be a number',a,"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new v('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>f+n)throw new v('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new v('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=f-n)throw new I('"exp" claim timestamp check failed',a,"exp","check_failed")}if(l){let e=f-a.iat;if(e-n>("number"==typeof l?l:ty(l)))throw new I('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(e<0-n)throw new v('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function tE(e,t,r){let a=await th(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new T("JWTs MUST NOT use unencoded payload");let n={payload:tg(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...n,key:a.key}:n}async function tb(e,t,r){let a=await e4(e,t,r),n=tg(a.protectedHeader,a.plaintext,r),{protectedHeader:i}=a;if(void 0!==i.iss&&i.iss!==n.iss)throw new v('replicated "iss" claim header parameter mismatch',n,"iss","mismatch");if(void 0!==i.sub&&i.sub!==n.sub)throw new v('replicated "sub" claim header parameter mismatch',n,"sub","mismatch");if(void 0!==i.aud&&JSON.stringify(i.aud)!==JSON.stringify(n.aud))throw new v('replicated "aud" claim header parameter mismatch',n,"aud","mismatch");let s={payload:n,protectedHeader:i};return"function"==typeof t?{...s,key:a.key}:s}class tA{constructor(e){this._flattened=new tn(e)}setContentEncryptionKey(e){return this._flattened.setContentEncryptionKey(e),this}setInitializationVector(e){return this._flattened.setInitializationVector(e),this}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}setKeyManagementParameters(e){return this._flattened.setKeyManagementParameters(e),this}async encrypt(e,t){let r=await this._flattened.encrypt(e,t);return[r.protected,r.encrypted_key,r.iv,r.ciphertext,r.tag].join(".")}}let tS=async(e,t,r)=>{let a=await tc(e,t,"sign");return em(e,a),new Uint8Array(await c.subtle.sign(to(e,a.algorithm),a,r))};class t_{constructor(e){if(!(e instanceof Uint8Array))throw TypeError("payload must be an instance of Uint8Array");this._payload=e}setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setUnprotectedHeader(e){if(this._unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this._unprotectedHeader=e,this}async sign(e,t){let r;if(!this._protectedHeader&&!this._unprotectedHeader)throw new P("either setProtectedHeader or setUnprotectedHeader must be called before #sign()");if(!ea(this._protectedHeader,this._unprotectedHeader))throw new P("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let a={...this._protectedHeader,...this._unprotectedHeader},n=e5(P,new Map([["b64",!0]]),t?.crit,this._protectedHeader,a),i=!0;if(n.has("b64")&&"boolean"!=typeof(i=this._protectedHeader.b64))throw new P('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:s}=a;if("string"!=typeof s||!s)throw new P('JWS "alg" (Algorithm) Header Parameter missing or invalid');eY(s,e,"sign");let o=this._payload;i&&(o=h.encode(b(o)));let c=u(r=this._protectedHeader?h.encode(b(JSON.stringify(this._protectedHeader))):h.encode(""),h.encode("."),o),d={signature:b(await tS(s,e,c)),payload:""};return i&&(d.payload=p.decode(o)),this._unprotectedHeader&&(d.header=this._unprotectedHeader),this._protectedHeader&&(d.protected=p.decode(r)),d}}class tv{constructor(e){this._flattened=new t_(e)}setProtectedHeader(e){return this._flattened.setProtectedHeader(e),this}async sign(e,t){let r=await this._flattened.sign(e,t);if(void 0===r.payload)throw TypeError("use the flattened module for creating JWS with b64: false");return`${r.protected}.${r.payload}.${r.signature}`}}class tI{constructor(e,t,r){this.parent=e,this.key=t,this.options=r}setProtectedHeader(e){if(this.protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this.protectedHeader=e,this}setUnprotectedHeader(e){if(this.unprotectedHeader)throw TypeError("setUnprotectedHeader can only be called once");return this.unprotectedHeader=e,this}addSignature(...e){return this.parent.addSignature(...e)}sign(...e){return this.parent.sign(...e)}done(){return this.parent}}class tC{constructor(e){this._signatures=[],this._payload=e}addSignature(e,t){let r=new tI(this,e,t);return this._signatures.push(r),r}async sign(){if(!this._signatures.length)throw new P("at least one signature must be added");let e={signatures:[],payload:""};for(let t=0;t<this._signatures.length;t++){let r=this._signatures[t],a=new t_(this._payload);a.setProtectedHeader(r.protectedHeader),a.setUnprotectedHeader(r.unprotectedHeader);let{payload:n,...i}=await a.sign(r.key,r.options);if(0===t)e.payload=n;else if(e.payload!==n)throw new P("inconsistent use of JWS Unencoded Payload (RFC7797)");e.signatures.push(i)}return e}}function tH(e,t){if(!Number.isFinite(t))throw TypeError(`Invalid ${e} input`);return t}class tk{constructor(e={}){if(!en(e))throw TypeError("JWT Claims Set MUST be an object");this._payload=e}setIssuer(e){return this._payload={...this._payload,iss:e},this}setSubject(e){return this._payload={...this._payload,sub:e},this}setAudience(e){return this._payload={...this._payload,aud:e},this}setJti(e){return this._payload={...this._payload,jti:e},this}setNotBefore(e){return"number"==typeof e?this._payload={...this._payload,nbf:tH("setNotBefore",e)}:e instanceof Date?this._payload={...this._payload,nbf:tH("setNotBefore",tu(e))}:this._payload={...this._payload,nbf:tu(new Date)+ty(e)},this}setExpirationTime(e){return"number"==typeof e?this._payload={...this._payload,exp:tH("setExpirationTime",e)}:e instanceof Date?this._payload={...this._payload,exp:tH("setExpirationTime",tu(e))}:this._payload={...this._payload,exp:tu(new Date)+ty(e)},this}setIssuedAt(e){return void 0===e?this._payload={...this._payload,iat:tu(new Date)}:e instanceof Date?this._payload={...this._payload,iat:tH("setIssuedAt",tu(e))}:"string"==typeof e?this._payload={...this._payload,iat:tH("setIssuedAt",tu(new Date)+ty(e))}:this._payload={...this._payload,iat:tH("setIssuedAt",e)},this}}class tD extends tk{setProtectedHeader(e){return this._protectedHeader=e,this}async sign(e,t){let r=new tv(h.encode(JSON.stringify(this._payload)));if(r.setProtectedHeader(this._protectedHeader),Array.isArray(this._protectedHeader?.crit)&&this._protectedHeader.crit.includes("b64")&&!1===this._protectedHeader.b64)throw new T("JWTs MUST NOT use unencoded payload");return r.sign(e,t)}}class tP extends tk{setProtectedHeader(e){if(this._protectedHeader)throw TypeError("setProtectedHeader can only be called once");return this._protectedHeader=e,this}setKeyManagementParameters(e){if(this._keyManagementParameters)throw TypeError("setKeyManagementParameters can only be called once");return this._keyManagementParameters=e,this}setContentEncryptionKey(e){if(this._cek)throw TypeError("setContentEncryptionKey can only be called once");return this._cek=e,this}setInitializationVector(e){if(this._iv)throw TypeError("setInitializationVector can only be called once");return this._iv=e,this}replicateIssuerAsHeader(){return this._replicateIssuerAsHeader=!0,this}replicateSubjectAsHeader(){return this._replicateSubjectAsHeader=!0,this}replicateAudienceAsHeader(){return this._replicateAudienceAsHeader=!0,this}async encrypt(e,t){let r=new tA(h.encode(JSON.stringify(this._payload)));return this._replicateIssuerAsHeader&&(this._protectedHeader={...this._protectedHeader,iss:this._payload.iss}),this._replicateSubjectAsHeader&&(this._protectedHeader={...this._protectedHeader,sub:this._payload.sub}),this._replicateAudienceAsHeader&&(this._protectedHeader={...this._protectedHeader,aud:this._payload.aud}),r.setProtectedHeader(this._protectedHeader),this._iv&&r.setInitializationVector(this._iv),this._cek&&r.setContentEncryptionKey(this._cek),this._keyManagementParameters&&r.setKeyManagementParameters(this._keyManagementParameters),r.encrypt(e,t)}}let tT=(e,t)=>{if("string"!=typeof e||!e)throw new R(`${t} missing or invalid`)};async function tR(e,t){let r;if(!en(e))throw TypeError("JWK must be an object");if(t??(t="sha256"),"sha256"!==t&&"sha384"!==t&&"sha512"!==t)throw TypeError('digestAlgorithm must one of "sha256", "sha384", or "sha512"');switch(e.kty){case"EC":tT(e.crv,'"crv" (Curve) Parameter'),tT(e.x,'"x" (X Coordinate) Parameter'),tT(e.y,'"y" (Y Coordinate) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x,y:e.y};break;case"OKP":tT(e.crv,'"crv" (Subtype of Key Pair) Parameter'),tT(e.x,'"x" (Public Key) Parameter'),r={crv:e.crv,kty:e.kty,x:e.x};break;case"RSA":tT(e.e,'"e" (Exponent) Parameter'),tT(e.n,'"n" (Modulus) Parameter'),r={e:e.e,kty:e.kty,n:e.n};break;case"oct":tT(e.k,'"k" (Key Value) Parameter'),r={k:e.k,kty:e.kty};break;default:throw new H('"kty" (Key Type) Parameter missing or unsupported')}let a=h.encode(JSON.stringify(r));return b(await l(t,a))}async function tK(e,t){t??(t="sha256");let r=await tR(e,t);return`urn:ietf:params:oauth:jwk-thumbprint:sha-${t.slice(-3)}:${r}`}async function tO(e,t){let r={...e,...t?.header};if(!en(r.jwk))throw new P('"jwk" (JSON Web Key) Header Parameter must be a JSON object');let a=await ej({...r.jwk,ext:!0},r.alg);if(a instanceof Uint8Array||"public"!==a.type)throw new P('"jwk" (JSON Web Key) Header Parameter must be a public key');return a}function tW(e){return en(e)}function tN(e){return"function"==typeof structuredClone?structuredClone(e):JSON.parse(JSON.stringify(e))}class tJ{constructor(e){if(this._cached=new WeakMap,!function(e){return e&&"object"==typeof e&&Array.isArray(e.keys)&&e.keys.every(tW)}(e))throw new K("JSON Web Key Set malformed");this._jwks=tN(e)}async getKey(e,t){let{alg:r,kid:a}={...e,...t?.header},n=function(e){switch("string"==typeof e&&e.slice(0,2)){case"RS":case"PS":return"RSA";case"ES":return"EC";case"Ed":return"OKP";default:throw new H('Unsupported "alg" value for a JSON Web Key Set')}}(r),i=this._jwks.keys.filter(e=>{let t=n===e.kty;if(t&&"string"==typeof a&&(t=a===e.kid),t&&"string"==typeof e.alg&&(t=r===e.alg),t&&"string"==typeof e.use&&(t="sig"===e.use),t&&Array.isArray(e.key_ops)&&(t=e.key_ops.includes("verify")),t)switch(r){case"ES256":t="P-256"===e.crv;break;case"ES256K":t="secp256k1"===e.crv;break;case"ES384":t="P-384"===e.crv;break;case"ES512":t="P-521"===e.crv;break;case"Ed25519":t="Ed25519"===e.crv;break;case"EdDSA":t="Ed25519"===e.crv||"Ed448"===e.crv}return t}),{0:s,length:o}=i;if(0===o)throw new O;if(1!==o){let e=new W,{_cached:t}=this;throw e[Symbol.asyncIterator]=async function*(){for(let e of i)try{yield await tU(t,e,r)}catch{}},e}return tU(this._cached,s,r)}}async function tU(e,t,r){let a=e.get(t)||e.set(t,{}).get(t);if(void 0===a[r]){let e=await ej({...t,ext:!0},r);if(e instanceof Uint8Array||"public"!==e.type)throw new K("JSON Web Key Set members must be public keys");a[r]=e}return a[r]}function tM(e){let t=new tJ(e),r=async(e,r)=>t.getKey(e,r);return Object.defineProperties(r,{jwks:{value:()=>tN(t._jwks),enumerable:!0,configurable:!1,writable:!1}}),r}let tx=async(e,t,r)=>{let a,n,i=!1;"function"==typeof AbortController&&(a=new AbortController,n=setTimeout(()=>{i=!0,a.abort()},t));let s=await fetch(e.href,{signal:a?a.signal:void 0,redirect:"manual",headers:r.headers}).catch(e=>{if(i)throw new N;throw e});if(void 0!==n&&clearTimeout(n),200!==s.status)throw new _("Expected 200 OK from the JSON Web Key Set HTTP response");try{return await s.json()}catch{throw new _("Failed to parse the JSON Web Key Set HTTP response as JSON")}};"undefined"!=typeof navigator&&navigator.userAgent?.startsWith?.("Mozilla/5.0 ")||(i="jose/v5.10.0");let tL=Symbol();class tB{constructor(e,t){if(!(e instanceof URL))throw TypeError("url must be an instance of URL");this._url=new URL(e.href),this._options={agent:t?.agent,headers:t?.headers},this._timeoutDuration="number"==typeof t?.timeoutDuration?t?.timeoutDuration:5e3,this._cooldownDuration="number"==typeof t?.cooldownDuration?t?.cooldownDuration:3e4,this._cacheMaxAge="number"==typeof t?.cacheMaxAge?t?.cacheMaxAge:6e5,t?.[tL]!==void 0&&(this._cache=t?.[tL],function(e,t){return!("object"!=typeof e||null===e||!("uat"in e)||"number"!=typeof e.uat||Date.now()-e.uat>=t)&&"jwks"in e&&!!en(e.jwks)&&!!Array.isArray(e.jwks.keys)&&!!Array.prototype.every.call(e.jwks.keys,en)}(t?.[tL],this._cacheMaxAge)&&(this._jwksTimestamp=this._cache.uat,this._local=tM(this._cache.jwks)))}coolingDown(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cooldownDuration}fresh(){return"number"==typeof this._jwksTimestamp&&Date.now()<this._jwksTimestamp+this._cacheMaxAge}async getKey(e,t){this._local&&this.fresh()||await this.reload();try{return await this._local(e,t)}catch(r){if(r instanceof O&&!1===this.coolingDown())return await this.reload(),this._local(e,t);throw r}}async reload(){this._pendingFetch&&("undefined"!=typeof WebSocketPair||"undefined"!=typeof navigator&&"Cloudflare-Workers"===navigator.userAgent||"undefined"!=typeof EdgeRuntime&&"vercel"===EdgeRuntime)&&(this._pendingFetch=void 0);let e=new Headers(this._options.headers);i&&!e.has("User-Agent")&&(e.set("User-Agent",i),this._options.headers=Object.fromEntries(e.entries())),this._pendingFetch||(this._pendingFetch=tx(this._url,this._timeoutDuration,this._options).then(e=>{this._local=tM(e),this._cache&&(this._cache.uat=Date.now(),this._cache.jwks=e),this._jwksTimestamp=Date.now(),this._pendingFetch=void 0}).catch(e=>{throw this._pendingFetch=void 0,e})),await this._pendingFetch}}function tj(e,t){let r=new tB(e,t),a=async(e,t)=>r.getKey(e,t);return Object.defineProperties(a,{coolingDown:{get:()=>r.coolingDown(),enumerable:!0,configurable:!1},fresh:{get:()=>r.fresh(),enumerable:!0,configurable:!1},reload:{value:()=>r.reload(),enumerable:!0,configurable:!1,writable:!1},reloading:{get:()=>!!r._pendingFetch,enumerable:!0,configurable:!1},jwks:{value:()=>r._local?.jwks(),enumerable:!0,configurable:!1,writable:!1}}),a}let t$=tL;class tF extends tk{encode(){let e=b(JSON.stringify({alg:"none"})),t=b(JSON.stringify(this._payload));return`${e}.${t}.`}static decode(e,t){let r;if("string"!=typeof e)throw new T("Unsecured JWT must be a string");let{0:a,1:n,2:i,length:s}=e.split(".");if(3!==s||""!==i)throw new T("Invalid Unsecured JWT");try{if(r=JSON.parse(p.decode(S(a))),"none"!==r.alg)throw Error()}catch{throw new T("Invalid Unsecured JWT")}return{payload:tg(r,S(n),t),header:r}}}let tV=b,tG=S;function tz(e){let t;if("string"==typeof e){let r=e.split(".");(3===r.length||5===r.length)&&([t]=r)}else if("object"==typeof e&&e)if("protected"in e)t=e.protected;else throw TypeError("Token does not contain a Protected Header");try{if("string"!=typeof t||!t)throw Error();let e=JSON.parse(p.decode(tG(t)));if(!en(e))throw Error();return e}catch{throw TypeError("Invalid Token or Protected Header formatting")}}function tX(e){let t,r;if("string"!=typeof e)throw new T("JWTs must use Compact JWS serialization, JWT must be a string");let{1:a,length:n}=e.split(".");if(5===n)throw new T("Only JWTs using Compact JWS serialization can be decoded");if(3!==n)throw new T("Invalid JWT");if(!a)throw new T("JWTs must contain a payload");try{t=tG(a)}catch{throw new T("Failed to base64url decode the payload")}try{r=JSON.parse(p.decode(t))}catch{throw new T("Failed to parse the decoded payload as JSON")}if(!en(r))throw new T("Invalid JWT Claims Set");return r}async function tY(e,t){let r,a,n;switch(e){case"HS256":case"HS384":case"HS512":r=parseInt(e.slice(-3),10),a={name:"HMAC",hash:`SHA-${r}`,length:r},n=["sign","verify"];break;case"A128CBC-HS256":case"A192CBC-HS384":case"A256CBC-HS512":return U(new Uint8Array((r=parseInt(e.slice(-3),10))>>3));case"A128KW":case"A192KW":case"A256KW":a={name:"AES-KW",length:r=parseInt(e.slice(1,4),10)},n=["wrapKey","unwrapKey"];break;case"A128GCMKW":case"A192GCMKW":case"A256GCMKW":case"A128GCM":case"A192GCM":case"A256GCM":a={name:"AES-GCM",length:r=parseInt(e.slice(1,4),10)},n=["encrypt","decrypt"];break;default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return c.subtle.generateKey(a,t?.extractable??!1,n)}function tq(e){let t=e?.modulusLength??2048;if("number"!=typeof t||t<2048)throw new H("Invalid or unsupported modulusLength option provided, 2048 bits or larger keys must be used");return t}async function tZ(e,t){let r,a;switch(e){case"PS256":case"PS384":case"PS512":r={name:"RSA-PSS",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tq(t)},a=["sign","verify"];break;case"RS256":case"RS384":case"RS512":r={name:"RSASSA-PKCS1-v1_5",hash:`SHA-${e.slice(-3)}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tq(t)},a=["sign","verify"];break;case"RSA-OAEP":case"RSA-OAEP-256":case"RSA-OAEP-384":case"RSA-OAEP-512":r={name:"RSA-OAEP",hash:`SHA-${parseInt(e.slice(-3),10)||1}`,publicExponent:new Uint8Array([1,0,1]),modulusLength:tq(t)},a=["decrypt","unwrapKey","encrypt","wrapKey"];break;case"ES256":r={name:"ECDSA",namedCurve:"P-256"},a=["sign","verify"];break;case"ES384":r={name:"ECDSA",namedCurve:"P-384"},a=["sign","verify"];break;case"ES512":r={name:"ECDSA",namedCurve:"P-521"},a=["sign","verify"];break;case"Ed25519":r={name:"Ed25519"},a=["sign","verify"];break;case"EdDSA":{a=["sign","verify"];let e=t?.crv??"Ed25519";switch(e){case"Ed25519":case"Ed448":r={name:e};break;default:throw new H("Invalid or unsupported crv option provided")}break}case"ECDH-ES":case"ECDH-ES+A128KW":case"ECDH-ES+A192KW":case"ECDH-ES+A256KW":{a=["deriveKey","deriveBits"];let e=t?.crv??"P-256";switch(e){case"P-256":case"P-384":case"P-521":r={name:"ECDH",namedCurve:e};break;case"X25519":case"X448":r={name:e};break;default:throw new H("Invalid or unsupported crv option provided, supported values are P-256, P-384, P-521, X25519, and X448")}break}default:throw new H('Invalid or unsupported JWK "alg" (Algorithm) Parameter value')}return c.subtle.generateKey(r,t?.extractable??!1,a)}async function tQ(e,t){return tZ(e,t)}async function t0(e,t){return tY(e,t)}let t1="WebCryptoAPI"}}]);